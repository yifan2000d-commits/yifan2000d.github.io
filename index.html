<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>METRO OPS | ä¿®å¤ç‰ˆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg-core: #0b0c10;
            --bg-panel: #1f2833;
            --text-bright: #66fcf1;
            --text-dim: #45a29e;
            --text-body: #c5c6c7;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: sans-serif;
            background-color: var(--bg-core);
            color: var(--text-body);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: 280px;
            background: #151b24;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            flex-shrink: 0; 
        }

        /* ğŸ”´ æ”¹ä¸ºæ©™è‰²ï¼Œç”¨äºéªŒè¯ä»£ç æ˜¯å¦æ›´æ–°æˆåŠŸ */
        .brand {
            padding: 20px;
            font-size: 18px;
            font-weight: 900;
            color: #ffa502; /* æ©™è‰² */
            border-bottom: 1px solid #333;
            cursor: pointer;
        }

        .search-container { padding: 15px; }
        .search-input {
            width: 100%;
            background: #0b0c10;
            border: 1px solid #45a29e;
            padding: 10px;
            color: white;
            border-radius: 4px;
        }

        .weapon-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .nav-item {
            padding: 12px;
            margin-bottom: 5px;
            background: #222;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-item:hover { background: #333; }
        .nav-item.active { background: #45a29e; color: #000; }

        /* ä¸»è§†å›¾åŒºåŸŸ - å¼ºåˆ¶æ’‘å¼€å®½åº¦ */
        .main-content {
            flex: 1;
            padding: 30px;
            background-color: #0b0c10;
            overflow-y: auto;
            position: relative;
            display: block; /* ç¡®ä¿ä¸æ˜¯ hidden */
        }

        /* ä»ªè¡¨ç›˜å®¹å™¨ - å¼ºåˆ¶é«˜åº¦å’Œè¾¹æ¡†ï¼Œé˜²æ­¢çœ‹ä¸è§ */
        .dashboard-view {
            max-width: 1200px;
            margin: 0 auto;
            display: block;
        }

        .chart-container-lg {
            background: var(--bg-panel);
            border: 2px solid #444; /* æ˜¾çœ¼çš„è¾¹æ¡† */
            border-radius: 12px;
            padding: 10px;
            height: 600px; /* å¼ºåˆ¶é«˜åº¦ */
            min-height: 600px;
            width: 100%;
            position: relative;
            margin-top: 20px;
        }

        /* è¯¦æƒ…é¡µå¡ç‰‡ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .info-card {
            background: #1f2833;
            border: 1px solid #444;
            padding: 20px;
            border-radius: 8px;
        }

        /* è°ƒè¯•ä¿¡æ¯ */
        .debug-msg {
            color: red; 
            border: 1px solid red; 
            padding: 10px; 
            margin-bottom: 10px;
            display: none; /* é»˜è®¤éšè—ï¼Œå‡ºé”™æ—¶æ˜¾ç¤º */
        }
    </style>
</head>
<body>

<div id="app" style="display: flex; width: 100%; height: 100%;">
    
    <div class="sidebar">
        <div class="brand" @click="viewMode = 'dashboard'">
            <i class="fa-solid fa-layer-group"></i> METRO DATA
        </div>
        <div class="search-container">
            <input type="text" class="search-input" v-model="searchQuery" placeholder="æœç´¢...">
        </div>
        <div class="weapon-list">
            <div v-for="w in filteredWeapons" :key="w.id" 
                 class="nav-item"
                 :class="{ active: currentWeapon && currentWeapon.id === w.id && viewMode === 'detail' }"
                 @click="selectWeapon(w)">
                <span>{{ w.name }}</span>
                <span style="font-size:10px; color:#888">{{ w.tier }}</span>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div id="error-box" class="debug-msg">System Error: Chart failed to load.</div>

        <div v-if="viewMode === 'dashboard'" class="dashboard-view">
            <h1 style="color: white; margin: 0;">æˆ˜æœ¯ç”Ÿæ€æ€»è§ˆ</h1>
            <p style="color: gray;">Pick Rate vs Win Rate</p>
            
            <div class="chart-container-lg">
                <p style="color: #666; text-align: center; position: absolute; width: 100%; top: 50%;">æ­£åœ¨åŠ è½½å›¾è¡¨æ•°æ®...</p>
                <canvas id="metaChart"></canvas>
            </div>
        </div>

        <div v-if="viewMode === 'detail' && currentWeapon" class="dashboard-view">
            <button @click="viewMode = 'dashboard'" style="padding: 5px 10px; cursor: pointer; margin-bottom: 10px;">è¿”å›</button>
            <h1 style="color: #66fcf1; font-size: 48px; margin: 0;">{{ currentWeapon.name }}</h1>
            
            <div class="card-grid">
                <div class="info-card">
                    <h3 style="color:gray; margin-top:0;">ç”Ÿæ€æ•°æ®</h3>
                    <div style="color:white;">ä½¿ç”¨ç‡: {{ currentWeapon.pickRate }}%</div>
                    <div style="color:white;">èƒœç‡: {{ currentWeapon.winRate }}%</div>
                </div>
                <div class="info-card">
                    <h3 style="color:gray; margin-top:0;">åŸºç¡€å±æ€§</h3>
                    <div style="color:white;">ä¼¤å®³: {{ currentWeapon.damage }}</div>
                    <div style="color:white;">å°„é€Ÿ: {{ currentWeapon.rate }}</div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

createApp({
    setup() {
        const weapons = [
            { id: 1, name: 'MK14', tier: 'T0', pickRate: 18, winRate: 72, damage: 61, rate: 650 },
            { id: 2, name: 'MG3', tier: 'T0', pickRate: 12, winRate: 75, damage: 40, rate: 990 },
            { id: 3, name: 'P90', tier: 'T0', pickRate: 22, winRate: 68, damage: 35, rate: 1000 },
            { id: 4, name: 'AWM', tier: 'T0', pickRate: 8, winRate: 45, damage: 105, rate: 30 },
            { id: 5, name: 'M416', tier: 'T1', pickRate: 62, winRate: 52, damage: 41, rate: 780 },
            { id: 6, name: 'GROZA', tier: 'T1', pickRate: 9, winRate: 60, damage: 47, rate: 750 },
            { id: 7, name: 'FAMAS', tier: 'T1', pickRate: 5, winRate: 58, damage: 38, rate: 900 },
            { id: 8, name: 'AKM', tier: 'T2', pickRate: 45, winRate: 48, damage: 48, rate: 600 },
            { id: 9, name: 'M762', tier: 'T2', pickRate: 35, winRate: 49, damage: 46, rate: 690 },
            { id: 10, name: 'Vector', tier: 'T2', pickRate: 28, winRate: 55, damage: 31, rate: 1100 },
            { id: 11, name: 'DP-28', tier: 'T2', pickRate: 15, winRate: 45, damage: 51, rate: 550 },
            { id: 12, name: 'DBS', tier: 'T2', pickRate: 10, winRate: 60, damage: 240, rate: 100 }
        ];

        const viewMode = ref('dashboard');
        const currentWeapon = ref(null);
        const searchQuery = ref('');
        let chartInstance = null;

        const filteredWeapons = computed(() => {
            if(!searchQuery.value) return weapons;
            return weapons.filter(w => w.name.toLowerCase().includes(searchQuery.value.toLowerCase()));
        });

        const selectWeapon = (w) => {
            currentWeapon.value = w;
            viewMode.value = 'detail';
        };

        const initChart = () => {
            const ctx = document.getElementById('metaChart');
            if(!ctx) return;
            
            // å®‰å…¨æ£€æŸ¥ï¼šå¦‚æœ Chart æ²¡æœ‰åŠ è½½
            if (typeof Chart === 'undefined') {
                document.getElementById('error-box').style.display = 'block';
                document.getElementById('error-box').innerText = "Error: Chart.js CDN load failed.";
                return;
            }

            if(chartInstance) chartInstance.destroy();

            chartInstance = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: 'Weapon Data',
                        data: weapons.map(w => ({ x: w.pickRate, y: w.winRate, r: 10, w: w })),
                        backgroundColor: weapons.map(w => w.tier === 'T0' ? '#ffa502' : '#45a29e')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: {display:true, text:'Pick Rate %'}, grid: {color:'#333'} },
                        y: { title: {display:true, text:'Win Rate %'}, grid: {color:'#333'} }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => ctx.raw.w.name
                            }
                        }
                    },
                    onClick: (e, elements) => {
                        if(elements.length > 0) {
                            const idx = elements[0].index;
                            selectWeapon(weapons[idx]);
                        }
                    }
                }
            });
        };

        watch(viewMode, (val) => {
            if(val === 'dashboard') setTimeout(initChart, 100);
        });

        onMounted(() => {
            setTimeout(initChart, 500); // å»¶è¿Ÿ500msç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
        });

        return {
            weapons,
            filteredWeapons,
            viewMode,
            currentWeapon,
            searchQuery,
            selectWeapon
        };
    }
}).mount('#app');
</script>
</body>
</html>
